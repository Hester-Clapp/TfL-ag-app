<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TfL-ag</title>
    <link rel="stylesheet" href="/style">
</head>

<body>
    <header>
        <h1>Home</h1>
    </header>
    <h2 id="welcome"></h2>
    <hr>
    <div>
        <h3>Your coins:</h3>
        <textarea readonly id="coins">...</textarea>
    </div>
    <hr>
    <a href="/deposit">Deposit</a>
    <a href="/challenges">Challenges</a>
    <a href="/steal">Steal</a>
    <hr>
    <h2>Teams:</h2>
    <table>
        <tr>
            <th>Team:</th>
            <th>Coins:</th>
            <th>Location:</th>
        </tr>
        <p>*list of teams fetched from server sorted by coins*</p>
    </table>
</body>
<script>
    // Get team from local storage or log in
    const team = localStorage.getItem("team")
    if (!team) window.location.href = "/login"
    document.getElementById("welcome").innerHTML = `Go team ${team}!`

    // Get player data from session storage or from server
    let teamData = JSON.parse(sessionStorage.getItem("teamData"))
    if (!teamData) {
        async function getPlayerData() {
            let response = await fetch(`/data`, {
                method: "POST",
                body: team
            }).then(async res => await res.json())
            if (Object.keys(response).length) {
                return response
            } else {
                await fetch(`/login`, {
                    method: "POST",
                    body: team
                })
                return getPlayerData()
            }
        }
        getPlayerData().then(v => {
            sessionStorage.setItem("teamData", JSON.stringify(v))
            document.getElementById("coins").value = v.coins
        })
    } else {
        document.getElementById("coins").value = teamData.coins
    }

</script>

</html>