<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TfL-ag</title>
    <link rel="stylesheet" href="/style">
</head>

<body>
    <header>
        <h1>Home</h1>
    </header>
    <main>

        <h2 id="welcome"></h2>
        <hr>
        <div>
            <h3>Your coins:</h3>
            <textarea readonly id="coins">...</textarea>
        </div>
        <hr>
        <a href="/deposit" class="button">Deposit</a>
        <a href="/challenges" class="button">Challenges</a>
        <a href="/steal" class="button">Steal</a>
        <hr>
        <h2>Activity:</h2>
        <textarea readonly id="activity"></textarea>
        <hr>
        <h2>Teams:</h2>
        <table>
            <tr>
                <th>Team:</th>
                <th>Coins:</th>
                <th>Location:</th>
            </tr>
            <p>*list of teams fetched from server sorted by coins*</p>
        </table>
    </main>
</body>
<script>
    // Get team from local storage or log in
    const team = localStorage.getItem("team")
    if (!team) window.location.href = "/login"
    document.getElementById("welcome").innerHTML = `Go team ${team}!`

    // Get data about all the teams

    // function getChallenges(callback) { fetch("/challenges.json").then(res => res.json().then(callback)) }
    fetch("/teams.json").then(res => res.json().then(teams => {
        console.log(teams)
    }))

    // Get player data from session storage or from server
    let teamData = JSON.parse(sessionStorage.getItem("teamData"))
    if (teamData) {
        document.getElementById("coins").value = teamData.coins
    } else {
        async function getPlayerData() {
            let response = await fetch(`/teamdata`, {
                method: "POST",
                body: team
            }).then(async res => await res.json())
            if (Object.keys(response).length) {
                return response
            } else {
                await fetch(`/login`, {
                    method: "POST",
                    body: team
                })
                return getPlayerData()
            }
        }
        getPlayerData().then(v => {
            sessionStorage.setItem("teamData", JSON.stringify(v))
            document.getElementById("coins").value = v.coins
        })
    }


</script>

</html>